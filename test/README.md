# Тестирование StudyTodo App

Этот каталог содержит все тесты для приложения StudyTodo.

## Структура тестов

### Unit тесты (`/models`, `/services`, `/blocs`)
- **Модели** (`/models`): Тесты для классов Task и Subject, включая сериализацию/десериализацию
- **Сервисы** (`/services`): Тесты для DatabaseService, AIService и NotificationService
- **BLoC** (`/blocs`): Тесты для TasksBloc и SubjectsBloc

### Widget тесты (`/widgets`)
- Тесты для UI компонентов приложения
- Проверка рендеринга, взаимодействия и состояний виджетов

### Integration тесты (`/integration`)
- Комплексные тесты пользовательских сценариев
- Тестирование взаимодействия компонентов
- **Примечание**: Большинство integration тестов требует настройку Firebase

### Помощники (`/test_helpers`)
- Утилиты для создания тестовых данных
- Общие функции для тестирования

## Запуск тестов

### Все тесты
```bash
flutter test
```

### Unit тесты
```bash
flutter test test/models/
flutter test test/services/
flutter test test/blocs/
```

### Widget тесты
```bash
flutter test test/widgets/
```

### Integration тесты
```bash
flutter test integration_test/
```

### Конкретный тест
```bash
flutter test test/models/task_test.dart
```

## Настройка для полного тестирования

### Firebase Emulator (для Database тестов)
1. Установить Firebase CLI
2. Инициализировать Firebase Emulator
3. Запустить эмулятор перед тестами

### AI Service тестирование
- Для полного тестирования AI функций требуется API ключ Gemini
- Установить переменную окружения `GEMINI_API_KEY`

## Покрытие тестами

Текущее покрытие:
- ✅ **Модели**: Полное покрытие Task и Subject
- ✅ **Сервисы**: Базовое покрытие (ограничено из-за внешних зависимостей)
- ✅ **BLoC**: Покрытие events/states (ограничено из-за mocking сложности)
- ✅ **Виджеты**: Базовые тесты для ключевых компонентов
- ⚠️ **Integration**: Заготовки (требует Firebase setup)

## Особенности тестирования

### Ограничения
1. **Firebase**: Многие тесты требуют Firebase Emulator для полной функциональности
2. **AI Service**: Требует реальный API ключ для полного тестирования
3. **Notifications**: Заглушка сервиса ограничивает тестирование
4. **Singleton Services**: Усложняет мокинг

### Рекомендации
1. Использовать Firebase Emulator для локальной разработки
2. Создать отдельные конфигурации для тестирования
3. Рассмотреть dependency injection для улучшения тестируемости
4. Добавить более детальные integration тесты по мере развития UI

## Добавление новых тестов

### Для новых моделей
1. Создать файл в `/models`
2. Тестировать сериализацию, конструкторы, методы

### Для новых виджетов
1. Создать файл в `/widgets`
2. Использовать `TestHelpers.createTestApp()` для обертки
3. Тестировать рендеринг, взаимодействие, состояния

### Для новых сервисов
1. Создать файл в `/services`
2. Мокать внешние зависимости
3. Тестировать публичные методы и обработку ошибок

## CI/CD

Для непрерывной интеграции рекомендуется:
1. Запускать все unit и widget тесты
2. Настроить Firebase Emulator в CI окружении
3. Генерировать отчеты о покрытии
4. Пропускать тесты, требующие внешних сервисов (marked as `skip`)